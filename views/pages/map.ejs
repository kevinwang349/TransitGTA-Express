<html>

<head>
    <meta charset="UTF-8">
    <title>System Maps</title>
    <%- include("../partials/head") %>
</head>

<body>
    <a href="https://transitGTA.onrender.com" style="font-size: 20px; color: #ff0000">Home</a>

    <p style="font-size: 20px;" id="load">Loading...Please wait...</p>

    <select id="mapname" style="font-size: 25px;" onchange="init()">
        <option value="Leaflet_Map">All routes & stops</option>
        <% mapJSON.forEach(map => {%>
            <option value="<%= map.url%>"><%= map.name%></option>
        <%})%>
    </select>
    <button style="font-size: 25px;" onclick="zoomToCurrent()">Zoom in to current location</button>
    <p style="font-size: 20px;">Zoom in to see more detail and to display stops</p>
    <div id="outerbox">
    </div>
    <br>
    <button style="font-size: 25px;" onclick="routeListRedirect()">See a full list of routes, with schedules and current bus locations</button>

    <script>
        function routeListRedirect(){
            window.location.href='https://transitGTA.onrender.com/<%= agency %>/routelist';
        }
        // Splits a CSV string into a 2D array
        function strArray(string) {
            const array1 = string.split('\n');
            let array2 = [];
            for (const el of array1) {
                array2.push(el.split(','));
            }
            return array2;
        }
        // Decodes strings passed from Express server
        function parseHtmlEntities(str) {
            return str.replace(/&#([0-9]{1,3});/gi, function(match, numStr) {
                var num = parseInt(numStr, 10); // read num as normal number
                return String.fromCharCode(num);
            });
        }

        const agency=`<%= agency%>`;
        const routeShapesStr=`<%= routeshapes%>`;
        const shapes=strArray(routeShapesStr);
    </script>
    <script type="text/javascript" src="/map.js"></script>
</body>

</html>